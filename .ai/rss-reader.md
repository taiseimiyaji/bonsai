以下は、Next.js + tRPC を利用した RSS + 情報収集機能の要件定義サンプルです。必要に応じて適宜追記・修正してください。

---

# 要件定義

## 1. 概要
- **目的**: ユーザーが興味・関心のあるウェブサイトやサービス(Zenn、はてなブックマークなどを含む)からの情報を一元的に収集し、閲覧できるシステムを提供する。
- **想定利用者**:
  - ログインユーザー(一般ユーザー)
  - 管理者(全員向けのRSSの設定・ユーザー管理 など)
  - ログインなしの閲覧ユーザー(一般公開RSSのみ参照)

- **利用技術**:
  - フロントエンド: [Next.js](https://nextjs.org/)
  - API層: [tRPC](https://trpc.io/)
  - 認証: NextAuth など(想定)
  - DB: PrismaやSupabaseなど(要検討)

---

## 2. ユースケース
1. **ログインユーザーとして個別のRSSを追加する**  
   - ユーザーがRSS URLを入力 → システムがRSSを取得・定期更新 → ユーザーは登録したフィード一覧を閲覧可能
2. **ログインなしユーザーとして全体公開のRSSを閲覧する**  
   - 管理者が設定した「全体公開RSS」リストを閲覧
   - 個別の登録やパーソナライズは不可
3. **管理者として全体公開RSSの登録・変更を行う**  
   - 管理者が追加・編集・削除した全体向けRSSをすべてのユーザー(ログインなし含む)が閲覧可能
4. **Zenn、はてなブックマーク等の情報収集**  
   - APIあるいはRSSフィード等を通じて記事リストを取得
   - ログインユーザー向けのカテゴリ分けなども検討

---

## 3. 機能要件

### 3.1 ユーザー管理
- **ユーザー登録/ログイン**  
  - OAuth(Google or GitHub)
  - ログインしていないユーザーは「全体公開RSS」のみを閲覧可能
  - すでに実装しているため、login/関連コードを確認
- **ユーザー情報編集**  
  - 表示名、プロフィール画像の設定(必要に応じて)

### 3.2 RSS登録・管理
- **個別RSS登録(ログインユーザーのみ)**  
  - RSSのURL入力 → 登録 → 以後自動収集  
  - 重複登録の判定(既に登録済みのRSSかどうか)
- **全体公開RSS(管理者のみ設定)**  
  - 管理者画面でRSSのURLを追加・編集・削除
  - 全体公開RSSはログインなしでも閲覧可能
- **定期収集(バックエンドジョブ)**  
  - 例: 1時間ごとにRSSを巡回し、新着情報をDBへ保存
  - 収集時の処理負荷を考慮し、バッチの実行タイミングや並列度を調整

### 3.3 情報収集(Zenn、はてなブックマークなど)
- **Zennからの情報収集**  
  - RSSが提供されている場合はRSS経由で収集  
  - もしくは公式APIがある場合はAPI連携
- **はてなブックマークからの情報収集**  
  - はてブRSS(特定URLの被ブックマーク情報)の取得  
  - 新着エントリやホットエントリを対象とする場合はカテゴリを指定する  
- **データ保存と重複チェック**  
  - 既存の記事URLをキーに重複を防止  
  - 新規の場合のみDBへ保存

### 3.4 表示・フィルタリング機能
- **フィード一覧表示**  
  - ユーザーごとに「自分が登録したRSSの最新記事」リストを時系列で表示  
  - ログインなしの場合は「全体公開RSSの最新記事」一覧を表示
- **検索・フィルタ**  
  - タイトルやソース別での検索  
  - カテゴリ・タグ機能(必要に応じて拡張)
- **ページネーション**  
  - 大量のフィードがある場合を想定し、ページネーションや無限スクロールなどで対応

---

## 4. 非機能要件

### 4.1 パフォーマンス
- **記事数増加に対応**  
  - RSS登録数および収集記事数が増えても一定の速度で表示できる
- **RSS収集の並列化**  
  - スケジューラを利用し、複数のRSSを効率的に取得
- デプロイ先はCloud Runとsupabase

### 4.2 セキュリティ
- **認証**  
  - JWTやOAuthでユーザーを認証  
  - セキュアなセッション管理
- **権限管理**  
  - 管理者/一般ユーザー/未ログインの閲覧範囲の切り分け
- **脆弱性対応**  
  - 外部ソース読み込み時のエスケープ処理(XSS対策など)

---

## 5. 画面例(ワイヤーフレーム想定)

1. **トップページ(未ログイン時)**
   - 全体公開RSSの記事一覧
   - ログイン/サインアップ導線

2. **ユーザーダッシュボード(ログイン時)**
   - 「自分の登録RSS」の記事一覧
   - 新規RSS追加フォーム
   - (オプション) 各サービス(Zenn, はてなブックマーク)の連携状況表示

3. **管理者画面**
   - 全体公開RSSの一覧表示・追加・編集・削除
   - ユーザー管理(登録ユーザーの一覧、権限変更など)

---

## 6. データ項目例
- **ユーザーテーブル(Users)**
  - `id`: ユーザーID
  - `email`: メールアドレス
  - `name`: 表示名
  - `role`: "admin" / "user"
  - `createdAt`, `updatedAt`
- **RSS管理テーブル(RSSFeeds)**
  - `id`: フィードID
  - `userId` (nullable): ログインユーザー用の場合は紐づけ、全体公開はnull
  - `url`: RSSフィードのURL
  - `title`: 登録されたフィードのタイトル
  - `type`: "public" / "private" など(オプション)
  - `createdAt`, `updatedAt`
- **記事テーブル(Articles)**
  - `id`: 記事ID
  - `feedId`: 紐づくRSS
  - `title`: 記事タイトル
  - `link`: 記事のURL
  - `publishedAt`: 投稿日
  - `createdAt`, `updatedAt`

---

## 7. API 仕様(tRPC想定例)
1. **auth**  
   - `login` / `logout`: ユーザー認証  
   - `getSession`: 現在のセッション情報を取得
2. **feed**  
   - `getFeeds(publicOnly)`: 全体公開RSS、もしくはログインユーザーのRSSを取得  
   - `createFeed(url)`: 新規フィード登録  
   - `deleteFeed(id)`: フィード削除
3. **article**  
   - `getArticles(feedId)`: 特定のフィードに紐づく記事一覧を取得  
   - `getAllArticles()`: 全体の記事を一覧取得(管理者向け)
4. **admin** (管理者専用)  
   - `getAllPublicFeeds()`, `createPublicFeed()`, `deletePublicFeed()`
   - `getAllUsers()`, `setUserRole()`

---

## 8. 今後の拡張
- **タグ/分類機能**: RSS毎にタグ付けし、記事リストでフィルタ  
- **ソーシャル連携**: Twitterへの自動投稿など  
- **通知機能**: 新着記事があればユーザーにプッシュ通知 or メール通知
